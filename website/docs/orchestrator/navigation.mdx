# Navigation

## Reprise de questionnaire

Lors de l'ouverture d'un questionnaire, une pop-up peut être proposée à l'utilisateur, afin de choisir s'il veut revenir sur la première page ou retourner directement à la page sur laquelle il se trouvait avant fermeture du questionnaire.
Cette pop-up est uniquement présente si les conditions suivantes sont respectées :

- l'orchestrateur est en mode écriture (collecte ou visualisation)
- l'état de questionnaire de l'unité est défini, et sa page courante n'est pas la première page (currentPage = '1') ([cf. état du questionnaire](./dataHandling#état-du-questionnaire))

## Navigation par page

### Précédent / Suivant

Depuis la barre de navigation sur la droite de la page, deux boutons Précédent/Suivant permettent de naviguer page par page dans le questionnaire.

Le bouton `Précédent` permet de naviguer vers la page précédente.  
Il est actif sur toutes les pages du questionnaire sauf la première.

Le bouton `Suivant` permet de naviguer vers la page suivante.  
En mode de relecture, le bouton est actif sur toutes les pages du questionnaire sauf la dernière page, à condition que la page contienne une réponse. En mode écriture (collecte ou visualisation), il n'est actif que sur les pages qui précèdent la dernière page atteinte.

### Continuer

Le bouton `Continuer` est présent uniquement en mode écriture, sur la partie centrale basse de l'écran.

Comme le bouton `Suivant`, il permet de naviguer vers la page suivante.
Il n'est affiché que en mode écriture, à condition que la page contienne une réponse.

## Navigation par séquence / sous-séquence

Dans l'en-tête de la page, on retrouve un fil d'Ariane avec la séquence et la sous-séquence (le cas échéant) qui contient la page courante.  
Ces deux éléments sont cliquables et permettent de naviguer directement vers la première page de la séquence (resp. sous-séquence).

Dans le menu de gauche, dans la rubrique "Enquête", on retrouve la structure du questionnaire avec ses séquences / sous-séquences , y compris pour les différentes itérations d'une boucle.  
Dès lors que la première page d'une séquence ou sous-séquence se situe avant la page courante, il est alors possible de sélectionner cette séquence ou sous-séquence dans le menu pour naviguer directement vers sa première page.

## Navigation par itération de boucle

Lorsque l'on se situe à l'intérieur d'une boucle, on affiche des cartes correspondant aux différentes itérations de la boucle (ex : une carte individu, affichant son prénom).  
Ces cartes ont trois états possibles, avec une ergonomie et un fonctionnement associé :

- itération en cours : la page courante se situe à l'intérieur de l'itération. La carte est cliquable et permet de revenir à la première page de l'itération
- itération déjà atteinte : la page courante ne se situe pas à l'intérieur de l'itération, mais on a déjà atteint cette itération. La carte est cliquable et permet de revenir à la première page de l'itération
- itération jamais atteinte : on n'a jamais atteint l'itération. La carte n'est pas cliquable

## Retour au début du questionnaire

Dans l'en-tête de la page, à droite du menu, le logo "Insee" est cliquable et permet de revenir à la première page du questionnaire.

## Sortie du questionnaire

### Bouton Quitter

Dans le coin haut-droit de la page, un bouton `Quitter` permet la sortie du questionnaire.  
Il est toujours présent, quel que soit le mode de l'orchestrateur, et quelle que soit la page du questionnaire.

Son fonctionnement diffère selon le mode de l'orchestrateur :

- mode de collecte : les données sont persistées, et l'orchestrateur envoie un événement de sortie de questionnaire. L'application qui intègre Drama-Queen a la responsabilité de rediriger l'utilisateur
- mode de visualisation : les données de l'unitée sont actualisées puis téléchargées (format identique à celui en entrée), et l'utilisateur est redirigé sur la [page de visualisation](../visualize.mdx)
- mode de relecture : la sortie du questionnaire provoque simplement l'ouverture d'une pop-up invitant l'utilisateur à fermer l'onglet de son navigateur

### Validation de fin

Sur la dernière page du questionnaire, un bouton de validation est présent dans la partie centrale basse de l'écran. Son libellé et son fonctionnement diffèrent selon le mode de l'orchestrateur :

- mode de collecte et de visualisation, `Valider et quitter` : fonctionne comme le [bouton Quitter](#bouton-quitter) , mais en forçant le passage de l'état du questionnaire de l'unité à "COMPLETED" puis "VALIDATED"
- mode de relecture, `Quitter` : fonctionne comme le [bouton Quitter](#bouton-quitter)

### Menu "Arrêt"

Dans le menu de gauche, une rubrique "Arrêt" est disponible lorsque l'on est en écriture (collecte ou visualisation en non lecture seule).

Cette rubrique propose deux modalités de sortie du questionnaire, provoquant chacune l'ouverture d'une pop-up décrivant l'action :

- l'arrêt définitif : fonctionne comme le [bouton de validation de fin](#validation-de-fin) , mais en étant accessible depuis n'importe quelle page du questionnaire
- l'arrêt provisoire : fonctionne comme le [bouton Quitter](#bouton-quitter)

## Raccourcis clavier

| Action                                   | Raccourci       |
| ---------------------------------------- | --------------- |
| Ouverture / Fermeture du menu            | Alt + B         |
| Sortie du questionnaire (bouton Quitter) | Alt + Q         |
| Précédent                                | Alt + backspace |
| Suivant                                  | Alt + Entrée    |
| Continuer                                | Alt + Entrée    |
| Suite de l'entretien                     | Alt + fin       |
