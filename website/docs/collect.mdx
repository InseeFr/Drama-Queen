# Mode de collecte

Le mode de collecte est celui utilisé pour faire passer le questionnement auprès d'un enquêté dans un contexte réel de collecte.  
Il doit pouvoir fonctionner en étant offline, la communication ne se jamais directement avec l'api mais uniquement avec l'indexDB du navigateur en local.

Pré-requis : avoir effectué une [synchronisation](synchronize.mdx) pour disposer des données associées à l'utilisateur (questionnaires, interrogations, nomenclatures) localement

## Récupération des ressources

- récupération de l'interrogation depuis l'indexDB
- récupération du modèle de questionnaire depuis l'indexDB
- récupération de toutes les nomenclatures associées au modèle de questionnaire depuis l'indexDB

## Cas d'erreur

Au chargement du questionnaire, une page d'erreur explicite s'affiche dans les cas suivants :

- une des ressources récupérées ne respecte pas le format attendu
- l'interrogation n'a pas pu être récupérée
- le modèle de questionnaire n'a pas pu être récupéré
- l'interrogation `interrogationId` n'est pas associée au modèle de questionnaire `questionnaireId`

## Persistance

La persistance des données s'effectue à chaque changement de page du questionnaire, quel que soit le moyen de navigation.

La mise à jour de l'interrogation se fait alors dans l'indexDB du navigateur.  
C'est lors de la prochaine synchronisation que ces données locales seront poussées dans l'api.
